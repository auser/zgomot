##############################################################################################################
module Zgomot::Comp

  #####-------------------------------------------------------------------------------------------------------
  class Pattern

    #####-------------------------------------------------------------------------------------------------------
    class << self
    
      #.......................................................................................................
      def n(p=[:C,4], len=4, v=0.6)
        Zgomot::Midi::Note.new(:pitch => p, :length => len, :velocity => (127.0*v).to_i)
      end

      #.........................................................................................................
      def c(ps, len=4, v=0.6)
        Chords.new(:pitches => ps, :length => len, :velocity => (127.0*v).to_i)
      end

      #.........................................................................................................
      def k(tonic=[:C,4], mode=0, len=4, v=0.6)
        Key.new(:tonic => tonic, :mode => mode, :length => len, :velocity => (127.0*v).to_i)
      end

    #### self
    end

    #####-------------------------------------------------------------------------------------------------------
    class << self

      #.........................................................................................................
      def define_method(*methods)
        methods.each do |method_name|
          class_eval <<-RUBY
            def #{method_name.to_s}(*args)
              @notes = nil
              @#{method_name.to_s} = args.first; self
            end
          RUBY
        end
      end
    
    #### self
    end

    #...........................................................................................................
    attr_reader :seq
    
    #...........................................................................................................
    def initialize(seq)
      @seq = [seq].flatten
    end

    #.........................................................................................................
    def method_missing(method, *args, &blk )
      @seq = seq.map do |p|
               p.respond_to?(method) ? p.send(method, *args, &blk) : p
             end
      self
    end

  #### Pattern
  end

#### Zgomot ::Comp
end
